{% extends "layout.html" %}

{% block title %}
Dashboard
{% endblock %}

{% block main %}
<script>


    function render_calendar() {
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            let calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: ['dayGrid', 'bootstrap', 'googleCalendar', "interaction"],
                themeSystem: 'bootstrap',
                googleCalendarApiKey: 'AIzaSyB7mWrsaWadYYix5J2lGpg3ppqsVw7hPAY',
                locale: "nl",
                height: "auto",
                eventSources: [{
                    googleCalendarId: 'eilinzon@gmail.com',
                },
                {
                    googleCalendarId: 'nl.dutch#holiday@group.v.calendar.google.com',
                    color: '#478006'

                }],
            });

            calendar.render();
        })
    }

    function add_datarange_pickers() {
        $(function () {
            $('input[name="daterange"]').daterangepicker({
                locale: {
                    separator: ' tot ',
                    format: 'DD-MM-YYYY',
                    daysOfWeek: ["zo", "ma", "di", "Wo", "do", "vr", "za"],
                    monthNames: ["januari", "februari", "maart", "april", "mei", "juni", "juli", "augustus", "september", "oktober", "november", "december"],
                    firstDay: 1,
                },
                opens: 'left',
                autoApply: true,
            });
            $('input[name="daterange_log"]').daterangepicker({
                locale: {
                    separator: ' tot ',
                    format: 'DD-MM-YYYY',
                    daysOfWeek: ["zo", "ma", "di", "Wo", "do", "vr", "za"],
                    monthNames: ["januari", "februari", "maart", "april", "mei", "juni", "juli", "augustus", "september", "oktober", "november", "december"],
                    firstDay: 1,
                },
                opens: 'left',
                autoApply: true,
            });
        });
    }

    function add_new_item() {
        if ($('input[name="new_item_item"]').val() == "")
            return false

        $.getJSON($SCRIPT_ROOT + '/add', {
            quantity: $('input[name="new_item_quantity"]').val(),
            item: $('input[name="new_item_item"]').val(),
            user: "Familie",

        }, function (data) {
            item = Object.keys(data)[0]
            item_object = $('#' + item)

            if (item_object.get("length") > 0) {
                item_object.empty()
            }

            $('#sl_table > tbody:last-child').prepend(
                '<tr id=' + item + '>\
                        <td>' + item + '</td>\
                        <td>' + data[item]["datetime"] + '</td>\
                        <td><button id=close class=close>x</button></td>\
                        </tr>'
            )
            $('input[name="new_item_item"]').val("")

        });
        return false;
    }

    function add_log() {

        $(function () {
            $(':button#add_log').on('click', function () {
                if ($('input[name="new_log_description"]').val() == "" || $('input[name="new_log_author"]').val() == "")
                    return false

                $.getJSON($SCRIPT_ROOT + '/add_log', {
                    description: $('textarea[name="new_log_description"]').val(),
                    author: $('input[name="new_log_author"]').val(),
                    datetime: $('input[name="daterange_log"]').val()

                }, function (data) {
                    item = Object.keys(data)[0]
                    item_object = $('#' + item)

                    if (item_object.get("length") > 0) {
                        item_object.empty()
                    }
                    $('#log_table > tbody:last-child').prepend(
                        '<tr id=' + item + '>\
                        <td>' + data[item]["datetime"] + '</td>\
                        <td>' + data[item]["author"] + '</td>\
                        <td>' + data[item]["description"] + '</td>\
                        </tr>'
                    )

                    $('textarea[name="new_log_description"]').val("")
                    $('input[name="new_log_author"]').val("")
                    $('input[name="daterange_log"]').val("")

                });
                return false;
            });
        });
    }

    function remove_item() {
        $(function () {
            $(document).on('click', ':button.close', function () {
                row = $(this).parent().parent()
                item_name = row.attr('id')
                row.remove()

                $.getJSON($SCRIPT_ROOT + '/remove', {
                    item: item_name
                }, function (data) { });
            });
        });
    }

    function onChange() {
        var filter = document.getElementById("search_field").value;
        $('#sl_table > tbody').empty()
        for (var i in sl_items) {
            if (sl_items[i].item.toLowerCase().match(filter.toLowerCase())) {
                $('#sl_table > tbody').append(
                    '<tr id=' + sl_items[i].item + '> \
                        <td>' + sl_items[i].item + '</td> \
                        <td>' + sl_items[i].datetime + '</td> \
                        <td><button onclick=' + close() + 'id=close class=close>x</button></td> \
                    </tr>')
            }
        }
    }

    $.getJSON($SCRIPT_ROOT + '/get_items', function (data) {
        sl_items = data.items
        console.log(data.items)
    })

    render_calendar()
    add_datarange_pickers()

</script>

<script></script>

<div class="row my-5">
    <!-- Agenda -->
    <div class="col-12 col-xl-6 bg-light rounded border p-3 m-5 mt-5" id="agenda" style="opacity:0.95">
        <h3 class="display-5">Agenda</h3>
        <div id='calendar'></div>

        <div>
            <button type="button" class="m-2 fc-today-button btn btn-primary" data-toggle="modal"
                data-target="#myModal">Voeg
                verblijf toe</button>
        </div>

    </div>
    <!--Boodschappenlijst-->
    <div class="col-12 col-xl bg-light rounded border p-3 m-5 mt-5" id="list" style="opacity:0.95  ">
        <div class="row">

            <div class="col-6">
                <h3 class="display-5">Takenlijst</h3>
            </div>
            <div class="col-4">
                <input id="search_field" oninput="onChange()" placeholder="Zoek">
            </div>
        </div>
        <div class="table-wrapper-scroll-y my-custom-scrollbar">
            <table class="table table-hover" id="sl_table">

                <thead>
                    <th class="w-50">Item</th>
                    <th class="w-25">Datum</th>
                    <th class="w-25"></th>
                </thead>

                <tbody>
                    {% for key, sl_item in sl_items.items() %}

                    <tr id={{ key }}>
                        <td>{{ key }}</td>
                        <td>{{ sl_item.datetime }}</td>
                        <td><button onclick="remove_item()" id=close class=close>x</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="table-wrapper">
            <table class="table my-0" id="table_add">
                <tr id="new_item">
                    <td>
                        <input class="form-control w-100" type="text" name="new_item_item" placeholder="Naam van item"
                            required="required">
                    </td>
                    <td><button type="button" onclick="add_new_item()" id="add"
                            class="btn btn-primary">Toevoegen</button></td>
                    <td>

                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<!-- Logboek -->
<div class="row my-3">
    <div class="col-12 col-xl bg-light rounded border p-3 mx-5 mb-4 spacer" style="opacity:0.95  ">
        <h3 class="display-5">Logboek</h3>

        <div class="table-wrapper my-custom-scrollbar-log">

            <table class="table" id=log_table>
                <tr>
                    <td>
                        <input class="form-control w-75" type="text" name="daterange_log" value="">
                        <i class="fa fa-calendar"></i>&nbsp;
                    </td>
                    <td>
                        <input class="form-control w-100" type="text" name="new_log_author" placeholder="Naam"
                            required="required">
                    </td>
                    <td>
                        <textarea class="form-control w-100" type="text" name="new_log_description"
                            placeholder="Beschrijving" required="required"></textarea>
                    </td>
                    <div>
                        <td><button type="button" onclick="add_log()" id="add_log"
                                class="btn btn-primary">Toevoegen</button></td>
                    </div>
                </tr>
                <tr>
                    <th>Verblijfsdata</th>
                    <th>Naam</th>
                    <th>Beschrijving</th>
                    <th></th>
                </tr>

                <tbody>
                    {% for key, log_item in log_items.items() %}
                    <tr id="log_tr" class=" border-3">
                        <td>{{ log_item.datetime }}</td>
                        <td>{{ log_item.author }}</td>
                        <td class="small_column">{{ log_item.description }}</td>
                    </tr>
                    {% endfor %}

                </tbody>
            </table>
        </div>
    </div>

</div>

<!-- The Modal -->
<div class="modal fade" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Maak nieuwe afspraak</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <form method="POST">
                    <div class="form-group">
                        <label for="staying date"><b>Verblijfsdata</b></label>
                    </div>
                    <div class="form-group">
                        <input type="text" name="daterange" value="">
                        <i class="fa fa-calendar"></i>&nbsp;
                    </div>
                    <div class="form-group">
                        <label for="staying_date"><b>Beschrijving</b></label>
                    </div>
                    <div class="form-group">
                        <textarea required name="description" class="form-control"></textarea>
                    </div>
                    <div class="form-group">

                        <!-- Modal footer -->
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Maak afspraak</button>
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Sluit</button>
                        </div>
                    </div>

                </form>

            </div>
        </div>
        </form>
    </div>
</div>



{% endblock %}